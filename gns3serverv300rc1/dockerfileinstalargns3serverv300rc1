# Usa una imagen base de Ubuntu
FROM ubuntu:20.04

# Establece el directorio de trabajo
WORKDIR /gns3

# Instala dependencias necesarias
RUN apt-get update && \
    apt-get install -y \
    wget \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg2 \
    software-properties-common \
    python3 \
    python3-pip \
    python3-pyqt5 \
    python3-pyqt5.qtsvg \
    python3-pyqt5.qtwebengine \
    python3-pyqt5.qtwebchannel \
    python3-pyqt5.qtmultimedia \
    python3-pyqt5.qtquick \
    python3-pyqt5.qtquickcontrols2 \
    python3-pyqt5.qtquickcontrols \
    ansible \
    && apt-get clean

# Agrega la clave GPG de Docker
RUN curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -

# Agrega el repositorio de Docker
RUN add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"

# Instala Docker
RUN apt-get update && \
    apt-get install -y docker-ce docker-ce-cli containerd.io && \
    apt-get clean

# Descarga GNS3 GUI v3.0.0b3
RUN wget https://github.com/GNS3/gns3-gui/archive/refs/tags/v3.0.0b3.tar.gz && \
    tar -xzf v3.0.0b3.tar.gz && \
    mv gns3-gui-3.0.0b3 gns3-gui && \
    rm v3.0.0b3.tar.gz

# Copia el playbook de Ansible al contenedor
COPY install_gns3.yml /gns3/install_gns3.yml

# Ejecuta el playbook de Ansible
CMD ["ansible-playbook", "install_gns3.yml"]
